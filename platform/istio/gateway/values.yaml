# Istio Ingress Gateway Helm Values
# Production-safe configuration for the ingress gateway

# Gateway name
name: istio-ingressgateway

# Labels to apply to the gateway
labels:
  app: istio-ingressgateway
  istio: ingressgateway

# High availability with multiple replicas
replicaCount: 2

# Autoscaling configuration
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80

# Resource allocation
resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 1Gi

# Service configuration
service:
  # LoadBalancer for production (internal in private subnet)
  type: LoadBalancer
  
  # Standard Istio gateway ports
  ports:
    - name: status-port
      port: 15021
      protocol: TCP
      targetPort: 15021
    - name: http2
      port: 80
      protocol: TCP
      targetPort: 8080
    - name: https
      port: 443
      protocol: TCP
      targetPort: 8443
  
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-internal: "true"
    service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
  
  # External traffic policy
  externalTrafficPolicy: Local

# Pod disruption budget for high availability
podDisruptionBudget:
  minAvailable: 1

securityContext:
  runAsUser: 1337
  runAsGroup: 1337
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL
    add:
      - NET_BIND_SERVICE

podSecurityContext:
  fsGroup: 1337

# Service account
serviceAccount:
  create: true
  name: istio-ingressgateway

# Pod anti-affinity to spread across zones and nodes
affinity:
  podAntiAffinity:
    # Prefer spreading across availability zones
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - istio-ingressgateway
          topologyKey: topology.kubernetes.io/zone
      # Prefer spreading across nodes
      - weight: 50
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - istio-ingressgateway
          topologyKey: kubernetes.io/hostname

tolerations: []
nodeSelector: {}

env:
  ISTIO_META_LOG_LEVEL: "warning"

rollingUpdate:
  maxSurge: 100%
  maxUnavailable: 25%

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "15020"
  prometheus.io/path: "/stats/prometheus"

revision: ""
networkGateway: ""
